
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{user/layout-user.html}">
<head>

    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">

    <style>

        /* Container chính */
        .bread-crumb {
            background: #fff;
            border-radius: 12px;
            padding: 15px 25px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.05);
            display: flex;
            align-items: center;
            gap: 10px;
            animation: fadeInBreadcrumb 0.5s ease-in-out;
        }

        /* Link breadcrumb */
        .bread-crumb a {
            color: #1e90ff;
            font-weight: 600;
            position: relative;
            transition: all 0.3s ease;
        }

        /* Hiệu ứng underline mượt */
        .bread-crumb a::after {
            content: '';
            position: absolute;
            bottom: -3px;
            left: 0;
            width: 0%;
            height: 2px;
            background-color: #1e90ff;
            transition: width 0.3s ease-in-out;
        }

        .bread-crumb a:hover::after {
            width: 100%;
        }

        /* Hover đổi màu + nổi lên */
        .bread-crumb a:hover {
            color: #ff4c60;
            transform: translateY(-2px);
        }

        /* Icon mũi tên */
        .bread-crumb i {
            color: #aaa;
            transition: transform 0.3s ease;
        }

        .bread-crumb a:hover i {
            transform: rotate(90deg);
            color: #ff4c60;
        }

        /* Breadcrumb hiện tại */
        .bread-crumb span {
            font-weight: 600;
            color: #555;
            background: linear-gradient(90deg, #f1f1f1, #ffffff);
            padding: 5px 12px;
            border-radius: 8px;
        }

        /* Animation xuất hiện */
        @keyframes fadeInBreadcrumb {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Container giỏ hàng trống */
        .d-flex.flex-column.align-items-center {
            animation: fadeInCart 0.6s ease-in-out;
            padding: 40px 20px;
            border-radius: 16px;
            background: linear-gradient(145deg, #f0f0f3, #ffffff);
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            transition: all 0.4s ease;
        }

        /* Hình ảnh "trống" lắc nhẹ */
        .d-flex.flex-column.align-items-center img {
            animation: floatCartImg 3s ease-in-out infinite;
            filter: drop-shadow(0 4px 10px rgba(0, 0, 0, 0.1));
        }

        /* Dòng chữ thông báo */
        .d-flex.flex-column.align-items-center h3 {
            font-size: 26px;
            font-weight: 600;
            letter-spacing: 0.5px;
            color: #444;
            background: linear-gradient(90deg, #007bff, #ff4c60);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            padding: 0 25px;
        }

        /* Cải tiến lại nút với khoảng cách hợp lý */
        .cart-btn-transform {
            margin-top: 16px; /* vừa phải hơn, không chèn lên chữ */
            background: linear-gradient(90deg, #007bff, #ff4c60);
            border: none;
            color: white;
            font-weight: 700;
            font-size: 16px;
            border-radius: 50px;
            padding: 14px 30px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease-in-out;
            animation: pulseGlow 2.5s infinite ease-in-out;
        }

        /* Hover vẫn giữ hiệu ứng xịn */
        .cart-btn-transform:hover {
            animation: blink-glow 1s infinite;
            background: linear-gradient(90deg, #ff4c60, #007bff);
            transform: scale(1.05);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
        }

        /* Pulse animation (tim đập hoặc năng lượng) */
        @keyframes pulseGlow {
            0% {
                box-shadow: 0 0 0 rgba(0, 123, 255, 0.4);
            }
            50% {
                box-shadow: 0 0 20px rgba(0, 123, 255, 0.8);
            }
            100% {
                box-shadow: 0 0 0 rgba(0, 123, 255, 0.4);
            }
        }

        /* Hiệu ứng text gradient */
        @keyframes gradientText {
            0% { background-position: 0% }
            100% { background-position: 100% }
        }

        /* Hình ảnh trôi nhẹ lên xuống */
        @keyframes floatCartImg {
            0%, 100% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-8px);
            }
        }

        /* Fade in tổng thể */
        @keyframes fadeInCart {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes blink-glow {
            0% {
                background: linear-gradient(90deg, #ff4c60, #007bff);
                box-shadow: 0 0 10px #ff4c60;
            }
            50% {
                background: linear-gradient(90deg, #007bff, #ff4c60);
                box-shadow: 0 0 20px #007bff;
            }
            100% {
                background: linear-gradient(90deg, #ff4c60, #007bff);
                box-shadow: 0 0 10px #ff4c60;
            }
        }

        /* Hiệu ứng mở modal */
        .modal.fade .modal-dialog {
            transform: scale(0.8);
            opacity: 0;
            transition: all 0.4s ease-in-out;
        }

        .modal.fade.show .modal-dialog {
            transform: scale(1);
            opacity: 1;
        }

        /* Đổi nền modal cho sang xịn */
        .modal-content {
            border: none;
            border-radius: 20px;
            background: linear-gradient(145deg, #ffffff, #e6ecff);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        /* Header bắt mắt */
        .modal-header {
            background: linear-gradient(to right, #4f46e5, #3b82f6);
            color: white;
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
            padding: 20px;
        }

        .modal-title {
            font-weight: bold;
            font-size: 20px;
            letter-spacing: 1px;
        }

        .modal-body {
            padding: 20px;
            background-color: #f9fbff;
            border-bottom-left-radius: 20px;
            border-bottom-right-radius: 20px;
        }

        /* Voucher item hover */
        .voucher-item {
            transition: all 0.3s ease-in-out;
            cursor: pointer;
            border-width: 2px !important;
        }

        .voucher-item:hover {
            background: linear-gradient(90deg, #e0f2fe, #bae6fd);
            box-shadow: 0 4px 20px rgba(0, 123, 255, 0.2);
            transform: translateY(-3px) scale(1.02);
            border-color: #2563eb !important;
        }

        /* Giảm giá đậm hơn */
        .amount-dis {
            color: #0d6efd;
            font-size: 18px;
        }

        /* Chữ phụ nhỏ nhẹ */
        .amount-mini,
        .amount-max,
        .text-sm {
            font-size: 14px;
            color: #6b7280;
        }

        /* Nút đóng */
        .modal-header .close {
            color: #dc3545; /* đỏ đậm */
            font-size: 25px;
            opacity: 0.85;
            transition: all 0.3s ease-in-out;
            text-shadow: 0 0 5px rgba(220, 53, 69, 0.5);
        }

        .modal-header .close:hover {
            opacity: 1;
            transform: scale(1.15) rotate(90deg);
            text-shadow: 0 0 10px rgba(220, 53, 69, 0.8);
        }

        /* Tổng thể bảng giỏ hàng */
        .wrap-table-shopping-cart {
            padding: 30px;
            background: linear-gradient(to right, #f8f9fa, #e9ecef);
            border-radius: 20px;
            box-shadow: 0 0 25px rgba(0, 0, 0, 0.1);
            overflow-x: auto;
            animation: fadeIn 0.8s ease-in-out;
        }

        /* Căn giữa nội dung ô (ngang và dọc) */
        .table-shopping-cart .column-1,
        .table-shopping-cart .column-4,
        .table-shopping-cart .column-5,
        .table-shopping-cart .column-2,
        .table-shopping-cart .column-3 {
            text-align: center !important;
            vertical-align: middle !important;
        }


        /* Tiêu đề bảng */
        /* Phần header bảng */
        .table_head {
            background: #4d4d4d; /*  xám đậm */
            text-align: center;
            text-transform: uppercase;
            font-weight: bold;
            animation: fadeIn 0.8s ease-in-out;
            box-shadow: 0 0 15px rgba(255, 105, 180, 0.3), 0 0 15px rgba(0, 255, 255, 0.3); /* ánh sáng dịu */
        }

        /* Các ô tiêu đề */
        .table_head th {
            color: #ffffff !important;
            text-align: center !important;
            vertical-align: middle !important;
            font-size: 15px;
            letter-spacing: 1px;
            text-shadow: none;
            display: table-cell;
            justify-content: center;
            align-items: center;
            margin: 0;
            padding: 16px;
        }




        /* Hàng sản phẩm */
        .table-row {
            transition: all 0.3s ease-in-out;
            background-color: #ffffff;
        }

        .table-row:hover {
            background: #f1f3f5;
            transform: scale(1.01);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        /* Ảnh sản phẩm */
        .how-itemcart1 img {
            width: 70px;
            height: 70px;
            object-fit: cover;
            border-radius: 12px;
            box-shadow: 0 0 8px rgba(0, 0, 0, 0.15);
            transition: transform 0.3s;
        }

        .how-itemcart1 img:hover {
            transform: scale(1.1) rotate(2deg);
        }

        /* Giá */
        .product-old-price {
            color: #dc3545;
        }

        .product-price {
            color: #000;
            font-weight: bold;
        }

        /* Tăng/giảm số lượng */
        .btn-num-product-down, .btn-num-product-up {
            background: #fff;
            border: 1px solid #ced4da;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            transition: all 0.3s ease;
            color: #000;
        }

        .btn-num-product-down:hover, .btn-num-product-up:hover {
            background: #ffffff;
            border-color: #999;
            transform: scale(1.1);
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
        }

        /* Nút Xóa – hiệu ứng ngầu lòi */
        .btn-danger {
            background-color: #dc3545;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            color: white;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(220, 53, 69, 0.3);
            transition: all 0.4s ease-in-out;
            position: relative;
            overflow: hidden;
        }

        .table-shopping-cart td:last-child {
            text-align: center;
            vertical-align: middle;
        }


        .btn-danger::after {
            content: "";
            position: absolute;
            top: 0;
            left: -75%;
            width: 150%;
            height: 100%;
            background: rgba(255, 255, 255, 0.15);
            transform: skewX(-20deg);
            transition: left 0.75s ease;
        }

        .btn-danger:hover::after {
            left: 125%;
        }

        .btn-danger:hover {
            transform: scale(1.05) rotate(-1deg);
            box-shadow: 0 10px 25px rgba(220, 53, 69, 0.5);
        }

        .wrap-num-product {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            background: rgba(255, 255, 255, 0.05);
            padding: 4px 8px;
            border-radius: 6px;
            box-shadow: 0 0 10px rgba(255, 0, 255, 0.2), 0 0 8px rgba(0, 255, 255, 0.1);
            max-width: 150px;
            margin: auto;
        }

        .btn-num-product-down,
        .btn-num-product-up {
            width: 26px;
            height: 26px;
            font-size: 12px;
            border-radius: 50%;
            background: linear-gradient(145deg, #ff00cc, #3333ff);
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .btn-num-product-down:hover,
        .btn-num-product-up:hover {
            transform: scale(1.15);
            box-shadow: 0 0 5px #0ff, 0 0 10px #f0f; /* neon xanh hồng nhẹ */
        }
        .btn-num-product-down:hover i,
        .btn-num-product-up:hover i {
            color: #ff00ff; /* hoặc màu hồng neon khi hover */
        }

        .num-product {
            width: 40px;
            text-align: center;
            font-size: 14px;
            color: #000; /* ✅ CHỈNH MÀU SỐ THÀNH MÀU ĐEN */
            background: #fff; /* Tăng độ tương phản nếu muốn */
            border: 1px solid #777;
            border-radius: 4px;
            padding: 2px 0;
            outline: none;
        }

        /* Khung tổng thể */
        .bor10 {
            background: linear-gradient(145deg, #ffffff, #f0f0f0);
            /*box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);*/
            border-radius: 16px;
            transition: all 0.3s ease;
        }

        .bor10 {
            position: relative;
            border-radius: 10px;
            z-index: 1;
            background-color: white; /* hoặc giữ màu gốc bạn đang dùng */
            overflow: hidden;
            /*box-shadow: 0 0 15px rgba(0, 255, 255, 0.2);*/
        }

        .bor10::before {
            content: '';
            position: absolute;
            top: -3px;
            left: -3px;
            right: -3px;
            bottom: -3px;
            background: #f9f9f9;
            background-size: 300% 300%;
            z-index: -1;
            /*animation: neonMove 6s linear infinite;*/
            border-radius: 12px;
            filter: blur(5px);
        }

        /* Tiêu đề */
        h4.mtext-109 {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            position: relative;
        }
        h4.mtext-109::after {
            content: "";
            position: absolute;
            bottom: -10px;
            left: 0;
            height: 3px;
            width: 60px;
            border-radius: 10px;
        }

        /* Label */
        .stext-110 {
            font-weight: 600;
            color: #444;
        }

        /* Display nội dung người dùng */
        .mtext-110 {
            transition: all 0.2s ease-in-out;
        }

        /* Icon chỉnh sửa */
        .pointer {
            cursor: pointer;
            transition: transform 0.2s ease, color 0.2s ease;
        }
        .pointer:hover {
            transform: scale(1.2);
            color: #ff4b2b;
        }

        /* Nút Thêm địa chỉ + */
        #add-address {
            border: none;
            color: white;
            background:#e0e0e0;
            padding: 10px 20px;
            border-radius: 10px;
            font-weight: 600;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            margin-top: 15px;
        }
        #add-address:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(91, 134, 229, 0.4);
        }

        /* Địa chỉ hiển thị */
        .address-item {
            background-color: #0b0b0b;
            padding: 12px 16px;
            border-radius: 10px;
            margin-bottom: 10px;
            transition: all 0.25s ease-in-out;
            cursor: pointer;
            border: 1px solid #ddd;
        }
        .address-item:hover {
            background-color: #e0f7ff;
            border-color: #36d1dc;
            box-shadow: 0 4px 12px rgba(0, 174, 255, 0.1);
            transform: scale(1.02);
        }

        /* Select dropdown */
        .rs1-select2 select {
            border: 1px solid #ccc;
            padding: 8px;
            border-radius: 8px;
            background-color: #fefefe;
            transition: border 0.2s ease;
        }
        .rs1-select2 select:focus {
            border-color: #36d1dc;
            outline: none;
        }

        /*/* Nút Lưu & Bỏ qua */*/
        /*#save-address-btn,*/
        /*#cancel-add-address {*/
        /*    margin-top: 10px;*/
        /*    margin-right: 10px;*/
        /*    padding: 10px 20px;*/
        /*    font-weight: bold;*/
        /*    border-radius: 8px;*/
        /*    transition: all 0.25s ease;*/
        /*}*/
        /*#save-address-btn {*/
        /*    background: linear-gradient(to right, #36d1dc, #5b86e5);*/
        /*    color: white;*/
        /*    border: none;*/
        /*}*/
        /*#save-address-btn:hover {*/
        /*    transform: scale(1.05);*/
        /*    box-shadow: 0 5px 15px rgba(91, 134, 229, 0.3);*/
        /*}*/
        /*#cancel-add-address {*/
        /*    border: 2px solid #ccc;*/
        /*    background-color: white;*/
        /*    color: #333;*/
        /*}*/
        /*#cancel-add-address:hover {*/
        /*    background-color: #f8f8f8;*/
        /*    transform: scale(1.03);*/
        /*}*/

        .bor10 {
            color: black;
            /*text-shadow: 0 0 5px rgba(255, 255, 255, 0.6);*/
        }

        /*.bor10 * {*/
        /*    color: white !important;*/
        /*}*/

        h4.mtext-109 {
            color: black;
            /*animation: neonFlash 2s infinite alternate;*/
            /*text-shadow:*/
            /*        0 0 5px #fff,*/
            /*        0 0 10px #ff00ff,*/
            /*        0 0 15px #00fff7,*/
            /*        0 0 20px #ff00ff,*/
            /*        0 0 25px #00fff7,*/
            /*        0 0 30px #ff00ff,*/
            /*        0 0 35px #00fff7;*/
        }

        /* Animation chuyển màu giữa neon hồng và xanh */
        /*@keyframes neonFlash {*/
        /*    0% {*/
        /*        text-shadow:*/
        /*                0 0 5px #fff,*/
        /*                0 0 10px #ff00ff,*/
        /*                0 0 15px #ff00ff,*/
        /*                0 0 20px #ff00ff,*/
        /*                0 0 25px #ff00ff,*/
        /*                0 0 30px #ff00ff,*/
        /*                0 0 35px #ff00ff;*/
        /*    }*/
        /*    100% {*/
        /*        text-shadow:*/
        /*                0 0 5px #fff,*/
        /*                0 0 10px #00fff7,*/
        /*                0 0 15px #00fff7,*/
        /*                0 0 20px #00fff7,*/
        /*                0 0 25px #00fff7,*/
        /*                0 0 30px #00fff7,*/
        /*                0 0 35px #00fff7;*/
        /*    }*/
        /*}*/

        #add-address {
            justify-content: center;  /* căn giữa ngang */
            align-items: center;      /* căn giữa dọc */
            width: 100%;              /* hoặc set cụ thể: 200px */
            height: 50px;
            position: relative;
            display: inline-block;
            padding: 14px 32px;
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            color: black;
            text-transform: uppercase;
            background: transparent;
            /*border: 2px solid #ff00ff;*/
            border-radius: 12px;
            cursor: pointer;
            z-index: 1;
            overflow: hidden;
            /*transition: all 0.4s ease-in-out;*/
            letter-spacing: 1px;
            /*box-shadow:*/
            /*        0 0 5px #ff00ff,*/
            /*        0 0 10px #00fff7,*/
            /*        0 0 15px #ff00ff;*/
        }

        /* Viền ánh sáng chuyển động */
        #add-address::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: #cccccc;
            background-size: 400% 400%;
            animation: borderFlow 4s linear infinite;
            z-index: -1;
            filter: blur(20px);
        }

        /* Lớp phủ màu nền nhẹ khi hover */
        #add-address:hover {
            color: #000;
            background-color: rgba(255, 255, 255, 0.2);
            /*box-shadow:*/
            /*        0 0 15px #ff00ff,*/
            /*        0 0 30px #00fff7,*/
            /*        0 0 45px #ff00ff;*/
            /*transform: scale(1.05);*/
        }

        /* Hiệu ứng chuyển động viền */
        @keyframes borderFlow {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }

        /* Nút LƯU - nhấp nháy hồng */
        /*@keyframes neon-pink {*/
        /*    0% {*/
        /*        box-shadow: 0 0 5px #ff00ff, 0 0 10px #ff00ff;*/
        /*    }*/
        /*    100% {*/
        /*        box-shadow: 0 0 15px #ff66ff, 0 0 25px #ff00ff;*/
        /*    }*/
        /*}*/

        /*@keyframes neon-blue {*/
        /*    0% {*/
        /*        box-shadow: 0 0 5px #00ffff, 0 0 10px #00ffff;*/
        /*    }*/
        /*    100% {*/
        /*        box-shadow: 0 0 15px #66ffff, 0 0 25px #00ffff;*/
        /*    }*/
        /*}*/

        #save-address-btn {
            background-color: #2563eb !important;
            color: #ffffff !important;
            border: 2px solid #ff00ff !important;
            padding: 12px 30px !important;
            border-radius: 12px !important;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            animation: neon-pink 1.5s infinite alternate;
            text-align: center;
            text-transform: uppercase;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            transition: 0.3s;
        }

        #save-address-btn:hover {
            animation: neon-pink 0.3s infinite alternate;
            transform: scale(1.05);
        }

        #cancel-add-address {
            background-color:  #e0e0e0 !important;
            color: #333333 !important;
            border: 2px solid #00ffff !important;
            padding: 12px 30px !important;
            border-radius: 12px !important;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            animation: neon-blue 1.5s infinite alternate;
            text-align: center;
            text-transform: uppercase;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            transition: 0.3s;
        }

        #cancel-add-address:hover {
            animation: neon-blue 0.3s infinite alternate;
            transform: scale(1.05);
        }

        /* Hiệu ứng Neon cho Checkbox */
        .checkbox input[type="checkbox"] {
            appearance: none;
            width: 20px;
            height: 20px;
            border: 2px solid black;
            border-radius: 4px;
            background-color: transparent;
            position: relative;
            cursor: pointer;
            /*box-shadow: 0 0 5px #00ffff, 0 0 10px #00ffff;*/
            transition: 0.3s ease-in-out;
        }

        .checkbox input[type="checkbox"]:checked {
            background-color: blue;
            box-shadow: 0 0 10px blue, 0 0 15px blue;
        }

        .checkbox input[type="checkbox"]::after {
            content: "";
            position: absolute;
            top: 2px;
            left: 6px;
            width: 4px;
            height: 10px;
            border: solid white;
            border-width: 0 2px 2px 0;
            opacity: 0;
            transform: rotate(45deg);
            transition: 0.2s;
        }

        .checkbox input[type="checkbox"]:checked::after {
            opacity: 1;
        }

        /* Hiệu ứng chữ điều khoản */
        .checkbox a {
            color: black  !important;
            text-shadow: 0 0 2px black ;
            font-weight: bold;
            transition: 0.3s;
        }

        .checkbox a:hover {
            color: blue !important;
            text-shadow: 0 0 10px blue;
            text-decoration: underline;
        }

        /* Nút Đặt Hàng ngầu lòi khi được enabled */
        #submitBtn {
            font-weight: bold;
            background-color: #111 !important;
            border: 2px solid black !important;
            box-shadow: 0 0 5px black;
            transition: 0.4s ease-in-out;
        }

        #submitBtn:hover:enabled {
            background-color: #000;
            color: white;
            /*box-shadow: 0 0 20px #00ffff, 0 0 40px #ff00ff;*/
            transform: scale(1.05);
            text-shadow: 0 0 5px white;
        }

        /* Nút khi disabled */
        #submitBtn:disabled {
            background-color: #333 !important;
            border-color: #777 !important;
            color: #888;
            box-shadow: none;
            cursor: not-allowed;
        }


        /*@keyframes neonGlow {*/
        /*    0%, 100% {*/
        /*        box-shadow: 0 0 10px #A1887F, 0 0 20px #A1887F, 0 0 30px #A1887F;*/
        /*        border-color: #A1887F;*/
        /*        color: white;*/
        /*    }*/
        /*    50% {*/
        /*        box-shadow: 0 0 5px #A1887F, 0 0 15px #A1887F, 0 0 25px #A1887F;*/
        /*        border-color: #A1887F;*/
        /*        color: white;*/
        /*    }*/
        /*}*/

        /* Ghi đè CSS cho nút Đặt hàng */
        #submitBtn:enabled {
            background-color: black !important;
            border: 2px solid black !important;
            color: white !important;
            animation: neonGlow 1.5s infinite ease-in-out;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            font-weight: bold;
        }

        /* Đổi màu chữ trong select2 thành đen */
        .select2-selection__rendered {
            color: black !important;
        }

        /* Nếu khung select2 đang có màu nền sáng, có thể bỏ background */
        .select2-selection {
            background-color: white !important;
            border: 1px solid #ccc !important;
            color: black !important;
        }

        /* Mặc định màu chữ đen cho tất cả địa chỉ */
        .address-item,
        .address-item * {
            color: black !important;
        }

        /* Nếu có địa chỉ được chọn mà bị đổi màu, xử lý luôn */
        .address-item.active,
        .address-item.active * {
            color: black !important;
        }

        /* Xử lý hover nếu cần */
        .address-item:hover {
            background-color: #e0f7fa; /* Nhẹ nhàng */
            color: black !important;
            cursor: pointer;
        }
        /* Màu chữ trong danh sách dropdown */
        .select2-container--default .select2-results__option {
            color: black !important;
            background-color: white; /* Nền trắng khi chưa hover */
        }

        /* Màu chữ khi đang hover */
        .select2-container--default .select2-results__option--highlighted[aria-selected] {
            background-color: #ccf0ff; /* hoặc màu neon bạn thích */
            color: black !important;
        }

        /* Màu trong vùng chọn (hiển thị sau khi chọn xong) */
        .select2-container--default .select2-selection--single .select2-selection__rendered {
            color: black !important;
        }

        /* Viền cũng neon nhưng text vẫn rõ ràng */
        .select2-container--default .select2-selection--single {
            border: 2px solid #ff00ff; /* viền neon hồng */
            background-color: white;
        }

        #street {
            color: #0b0b0b !important;
            background: transparent;
            border: 1px solid #E0E0E0;
            /*border-image:  ;*/
            /*animation: glow-border 1.5s infinite;*/
        }

        #street::placeholder {
            color: #555 !important;
        }

        /*@keyframes glow-border {*/
        /*    0% {*/
        /*        box-shadow: 0 0 5px #ff00cc;*/
        /*    }*/
        /*    50% {*/
        /*        box-shadow: 0 0 10px #3333ff;*/
        /*    }*/
        /*    100% {*/
        /*        box-shadow: 0 0 5px #ff00cc;*/
        /*    }*/
        /*}*/

        .address-list {
            padding-top: 15px;
            width: 100%;
        }

        .shipping-choose {
            display: flex;
            flex-direction: column;
            gap: 10px;

        }

        .address-item {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid black;
            border-radius: 10px;
            padding: 15px;
            color: #ffffff;
            text-align: center;
            transition: all 0.3s ease;
            box-shadow: 0 0 10px #ff00cc, 0 0 20px #00fff7;
            margin: 0 auto;
            width: 90%;
            max-width: 500px;
        }

        .address-item:hover {
            transform: scale(1.03);
            box-shadow: 0 0 15px #ff00cc, 0 0 30px #00fff7;
        }

        .address-item p {
            margin: 0;
            font-size: 16px;
            font-weight: bold;
            color: white;
        }

        .shipping-choose {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 20px;
        }

        .shipping-choose > div {
            background-color: rgba(255, 255, 255, 0.05);
            border: 0px solid black;
            border-radius: 10px;
            padding: 15px 20px;
            box-shadow: 0 0 10px black, 0 0 0px black;
            transition: all 0.3s ease;
            width: 90%;
            max-width: 500px;
            text-align: center;
        }

        .shipping-choose > div:hover {
            transform: scale(1.03);
            box-shadow: 0 0 15px #ff00cc, 0 0 30px #00fff7;
        }

        .shipping-choose p {
            margin: 0;
            font-size: 16px;
            font-weight: 600;
            color:#0b0b0b;
            word-wrap: break-word;
        }
        .shipping-choose.active{
            border: 1px solid #A9A9A9;
            background-color: #A9A9A9;
            color: #fff;
        }

        #name-input {
            color: #000 !important;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
            background-color: white !important;
            border: 1px solid #ccc;
            caret-color: black;
        }

        #name-input::placeholder {
            color: rgba(0, 0, 0, 0.6) !important;
        }

        #phone-input {
            color: #000 !important;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
            background-color: white !important;
            border: 1px solid #ccc;
            caret-color: black;
        }

        #phone-input::placeholder {
            color: rgba(0, 0, 0, 0.6) !important;
        }
        .shipping-choose.active {
            border: 2px solid #007bff;
            background-color: #e9f5ff;
            border-radius: 8px;
            transition: all 0.2s ease-in-out;
        }
        .shipping-choose {
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            cursor: pointer;
        }

        .shipping-choose.active {
            border: 2px solid #007bff;
            background-color: #e9f5ff;
            border-radius: 8px;
            transition: all 0.2s ease-in-out;
        }
    </style>
</head>
<body>

<div layout:fragment="content">
    <div id="loading-overlay">
        <div class="loading-spinner"></div>
    </div>
    <!-- Modal -->
    <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog"
         aria-labelledby="exampleModalCenterTitle" aria-hidden="true" style="z-index: 3000">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLongTitle">Chọn mã giảm giá</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" style="overflow-y:auto; max-height: 400px ">
                    <th:block th:each="voucher : ${discountCodes}">
                        <div th:data-voucher-id="${voucher.id}"
                             class="d-flex border border-primary rounded align-items-center cursor-pointer voucher-item mb-2">
                            <div class="col-sm-3 d-flex justify-content-center align-items-center "
                                 style="background-color: rgb(219 234 254); height: 80px">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                                    <path fill="currentColor"
                                          d="M12.79 21L3 11.21v2c0 .53.21 1.04.59 1.41l7.79 7.79c.78.78 2.05.78 2.83 0l6.21-6.21c.78-.78.78-2.05 0-2.83L12.79 21z"></path>
                                    <path fill="currentColor"
                                          d="M11.38 17.41c.78.78 2.05.78 2.83 0l6.21-6.21c.78-.78.78-2.05 0-2.83L12.63.58A2.04 2.04 0 0 0 11.21 0H5C3.9 0 3 .9 3 2v6.21c0 .53.21 1.04.59 1.41l7.79 7.79zM7.25 3a1.25 1.25 0 1 1 0 2.5a1.25 1.25 0 0 1 0-2.5z"></path>
                                </svg>
                            </div>
                            <div class="col-sm-9">
                                <div class="w-full">
                                    <p class="font-weight-bold amount-dis">Giảm
                                        <span th:if="${voucher.type == 2}"
                                              th:text="${#numbers.formatDecimal(voucher.discountAmount, 0, 'POINT', 0, 'COMMA') + ' VND'}"></span>
                                        <span th:if="${voucher.type == 1}" th:text="${voucher.percentage} + '%'"></span>
                                    </p>
                                    <div>
                                     <span class="mr-4 amount-mini"
                                           th:text="${'Cho đơn từ ' + #numbers.formatDecimal(voucher.minimumAmountInCart, 0, 'POINT', 0, 'COMMA') + ' VND'}">
                                     </span>
                                        <span class="amount-max" th:if="${voucher.type == 1}"
                                              th:text="'Giảm tối đa ' + ${#numbers.formatDecimal(voucher.maximumAmount, 0, 'POINT', 0, 'COMMA') + ' VND'}"></span>
                                    </div>

                                    <div class="d-flex align-items-center ">
                                        <span class="mr-2 text-sm text-gray-600"
                                              th:text="${'HSD: ' + #dates.format(voucher.endDate, 'dd/MM/yyyy')}">: [[]</span>
                                        <!--                                    <span class="text-sm text-gray-600 d-flex">-->
                                        <!--                                        <span>Còn: </span>-->
                                        <!--                                        <div class="progress-bar" role="progressbar" style="width: 75%" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100"></div>-->
                                        <!--                                    </span>-->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </th:block>

                </div>
            </div>
        </div>
    </div>
    <!-- breadcrumb -->
    <div class="container">
        <div class="bread-crumb flex-w p-l-25 p-r-15 p-t-30 p-lr-0-lg">
            <a href="/" class="stext-109 cl8 hov-cl1 trans-04">
                Home
                <i class="fa fa-angle-right m-l-9 m-r-10" aria-hidden="true"></i>
            </a>

            <span class="stext-109 cl4">
					Shoping Cart
				</span>
        </div>
    </div>

    <!-- Shoping Cart -->
    <form class="bg0 p-t-75 p-b-85">
        <div class="container">
            <div class="">
                <div class=" m-b-50">
                    <div class="">
                        <div th:if="${carts.size() == 0}" class="d-flex flex-column align-items-center">
                            <img src="https://i.imgur.com/dCdflKN.png" width="130" height="130"
                                 class="img-fluid mb-4 mr-3">
                            <h3><strong>Giỏ hàng hiện tại trống</strong></h3>
                            <a th:href="@{/product}" class="btn btn-primary cart-btn-transform m-3" data-abc="true">Tiếp
                                tục mua sắm</a>
                        </div>
                        <div class="wrap-table-shopping-cart">

                            <table class="table-shopping-cart" th:if="${carts.size() > 0}">
                                <tr class="table_head">
                                    <th class="column-3 ml-2">Ảnh</th>
                                    <th class="column-2">Tên</th>
                                    <th class="column-3">Đơn giá</th>
                                    <th class="column-1">Cỡ</th>
                                    <th class="column-1">Màu</th>
                                    <th class="column-4">Số lượng</th>
                                    <th class="column-5">Tổng</th>
                                    <th class="column-1">Thao tác</th>
                                </tr>
                                <tr class="table-row product-item" th:each="cart : *{carts}">
                                    <input type="hidden" th:value="${cart.id}" class="cartId">
                                    <input type="hidden" th:value="${cart.detail.id}" class="detailId">
                                    <td class="column-3">
                                        <div class="how-itemcart1 ml-2">
                                            <img th:src="@{'/' + ${cart.product.imageUrl}}" alt="IMG">
                                        </div>
                                    </td>
                                    <td class="column-3" th:text="${cart.product.name}"></td>
                                    <td class="column-3">
                                        <span class="product-old-price" th:if="${cart.detail.discountedPrice != null}"
                                              th:text="${#numbers.formatDecimal(cart.detail.price, 0, 'POINT', 0, 'COMMA')}"
                                              style="text-decoration: line-through; font-size: 12px"></span>
                                        <span class="product-price" th:if="${cart.detail.discountedPrice != null}"
                                              th:text="${#numbers.formatDecimal(cart.detail.discountedPrice, 0, 'POINT', 0, 'COMMA')}"></span>
                                        <span class="product-price" th:if="${cart.detail.discountedPrice == null}"
                                              th:text="${#numbers.formatDecimal(cart.detail.price, 0, 'POINT', 0, 'COMMA')}"></span>
                                    </td>
                                    <td class="column-1" th:text="${cart.detail.size.name}"></td>
                                    <td class="column-1" th:text="${cart.detail.color.name}"></td>
                                    <td class="column-4">
                                        <div class="wrap-num-product flex-w m-l-auto m-r-0">
                                            <div class="btn-num-product-down js-update-cart-down cl8 hov-btn3 trans-04 flex-c-m">
                                                <i class="fs-16 zmdi zmdi-minus"></i>
                                            </div>
<!--                                            <input class="mtext-104 cl3 txt-center num-product" type="number"-->
<!--                                                   th:name="'num-product'+${cart.id}" th:value="${cart.quantity}"-->
<!--                                                   th:min="0">-->
                                            <input class="num-product"
                                                   type="number"
                                                   th:value="${cart.quantity}"
                                                   th:name="'num-product'+${cart.id}"
                                                   th:min="0"
                                                   th:attr="data-max-stock=${cart.detail.quantity}" />
                                            <div class="btn-num-product-up  cl8 hov-btn3 trans-04 flex-c-m">
                                                <i class="fs-16 zmdi zmdi-plus"></i>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="column-5 total-money"></td>
                                    <td>
                                        <button type="button" class="how-itemcart1 btn btn-danger">Xóa</button>
                                    </td>
                                </tr>

                            </table>
                        </div>

                        <span class="d-inline-block p-t-18 p-b-15 p-l-2 btn-choose-voucher" data-toggle="modal"
                              data-target="#exampleModalCenter">

                                <span class="font-weight-bold">
                                    <i class="fa fa-tags" aria-hidden="true"></i>
                                    Chọn mã giảm giá
                                </span>
                            <!--                                                        <div-->
                            <!--                                                                class="flex-c-m stext-101 cl2 size-119 bg8 bor13 hov-btn3 p-lr-15 trans-04 pointer m-tb-10">-->
                            <!--                                                            Update Cart-->
                            <!--                                                        </div>-->
                        </span>
                        <div id="selected-voucher" class="p-l-2" data-selected="">

                        </div>
                    </div>
                </div>

            </div>


            <div class="row">

                <div class="col-6">
                    <div class="bor10 p-lr-40 p-t-30 p-b-40">
                        <h4 class="mtext-109 cl2 p-b-30">
                            Địa chỉ nhận hàng
                        </h4>
                        <div class="flex-w flex-t bor12 p-b-13" style="margin-bottom: 20px">
                            <div class="size-208">
                                <span class="stext-110 cl2">Tên người nhận:</span>
                            </div>
                            <div class="size-209">
                                <span id="name-display" class="mtext-110 cl2" th:text="${profile.name}">Placeholder</span>
                                <input type="text" id="name-input" class="form-control" style="display: none;" value=""/>
                                <i id="edit-name" class="fa fa-edit cl1 pointer" style="margin-left: 10px;"></i>
                                <i id="save-name" class="fa fa-save cl1 pointer"
                                   style="display: none; margin-left: 10px;"></i>
                            </div>
                        </div>

                        <div class="flex-w flex-t bor12 p-b-13" style="margin-bottom: 20px">
                            <div class="size-208">
                                <span class="stext-110 cl2">Số điện thoại:</span>
                            </div>
                            <div class="size-209">
                            <span id="phone-display" class="mtext-110 cl2"
                                  th:text="${profile.phoneNumber}">Placeholder</span>
                                <input type="text" id="phone-input" class="form-control" style="display: none;" value=""/>
                                <i id="edit-phone" class="fa fa-edit cl1 pointer" style="margin-left: 10px;"></i>
                                <i id="save-phone" class="fa fa-save cl1 pointer"
                                   style="display: none; margin-left: 10px;"></i>
                            </div>
                        </div>
                        <div class="flex-w flex-t" style="padding-bottom: 91px;">
                            <div class="size-208 w-full-ssm">
									<span class="stext-110 cl2">
										Địa chỉ:
									</span>
                            </div>

                            <div class="size-209 p-r-18 p-r-0-sm w-full-ssm">
                                <!--                                <p class="stext-111 cl6 p-t-2">-->
                                <!--                                    There are no shipping methods available. Please double check your address, or-->
                                <!--                                    contact us if you need any help.-->
                                <!--                                </p>-->
                                <div class="p-t-15 addressArea">
										<span class="stext-112 cl8">
											Chọn địa chỉ
										</span>
                                    <div class="address-list pt-15">
                                        <div th:if="${addressShippings.size() > 0}" class="pt-15">
                                            <div th:each="address : *{addressShippings}" class="shipping-choose">
                                                <div th:id="'shipping' + ${address.id}" class="address-item"
                                                     data-id="${address.id}">
                                                    <p th:text="${address.address}"></p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <button type="button" class="bg2 size-102" id="add-address">Thêm địa chỉ +</button>
                                    <!--     địa chỉ đầu
                                                                   -->

<!--                                    <div id="address-select-group" style="display: none">-->
<!--                                        &lt;!&ndash;                                    <div class="rs1-select2 rs2-select2 bor8 bg0 m-b-12 m-t-9">&ndash;&gt;-->
<!--                                        &lt;!&ndash;                                        <select class="js-select2" name="province" id="province">&ndash;&gt;-->

<!--                                        &lt;!&ndash;                                        </select>&ndash;&gt;-->
<!--                                        &lt;!&ndash;                                        <div class="dropDownSelect2"></div>&ndash;&gt;-->
<!--                                        &lt;!&ndash;                                    </div>&ndash;&gt;-->
<!--                                        <div class="rs1-select2 rs2-select2 bor8 bg0 m-b-12 m-t-9">-->
<!--                                            <select class="js-select2" name="district" id="district">-->

<!--                                            </select>-->
<!--                                            <div class="dropDownSelect2"></div>-->
<!--                                        </div>-->

<!--                                        <div class="rs1-select2 rs2-select2 bor8 bg0 m-b-12 m-t-9">-->
<!--                                            <select class="js-select2" name="ward" id="ward">-->

<!--                                            </select>-->
<!--                                            <div class="dropDownSelect2"></div>-->
<!--                                        </div>-->

<!--                                        <div class="bor8 bg0 m-b-12">-->
<!--                                            <input class="stext-111 cl8 plh3 size-111 p-lr-15" type="text" name="street"-->
<!--                                                   id="street"-->
<!--                                                   placeholder="Số nhà, đường, xóm">-->
<!--                                        </div>-->
<!--                                        <span class="stext-111 errorStreet" style="color: red; display: none">Vui lòng nhập số nhà, đường, xóm</span>-->
<!--                                        <div>-->
<!--                                            <button class="bg2 size-102 hov-btn3" type="button" id="save-address-btn">Lưu-->
<!--                                            </button>-->
<!--                                            <button class="bor8 size-102" type="button" id="cancel-add-address">Bỏ qua-->
<!--                                            </button>-->
<!--                                        </div>-->
<!--                                    </div>-->
                                    <div id="address-select-group" style="display: none">
                                        <div class="rs1-select2 rs2-select2 bor8 bg0 m-b-12 m-t-9">
                                            <select class="js-select2" name="province" id="province">
                                                <option value="">Chọn tỉnh, thành phố</option>
                                                <!-- Các tỉnh, thành phố sẽ được thêm vào đây -->
                                            </select>
                                            <div class="dropDownSelect2"></div>
                                        </div>

                                        <div class="rs1-select2 rs2-select2 bor8 bg0 m-b-12 m-t-9">
                                            <select class="js-select2" name="district" id="district">
                                                <option value="">Chọn quận, huyện</option>
                                                <!-- Các quận, huyện sẽ được thêm vào đây -->
                                            </select>
                                            <div class="dropDownSelect2"></div>
                                        </div>

                                        <div class="rs1-select2 rs2-select2 bor8 bg0 m-b-12 m-t-9">
                                            <select class="js-select2" name="ward" id="ward">
                                                <option value="">Chọn phường, xã</option>
                                                <!-- Các phường, xã sẽ được thêm vào đây -->
                                            </select>
                                            <div class="dropDownSelect2"></div>
                                        </div>

                                        <div class="bor8 bg0 m-b-12">
                                            <input class="stext-111 cl8 plh3 size-111 p-lr-15" type="text" name="street" id="street"
                                                   placeholder="Số nhà, đường, xóm">
                                        </div>
                                        <span class="stext-111 errorStreet" style="color: red; display: none">Vui lòng nhập số nhà, đường, xóm</span>
                                        <div>
                                            <button class="bg2 size-102 hov-btn3" type="button" id="save-address-btn">Lưu</button>
                                            <button class="bor8 size-102" type="button" id="cancel-add-address">Bỏ qua</button>
                                        </div>
                                    </div>
<!--                                       địa chỉ cuối -->
                                </div>
                            </div>
                        </div>


                    </div>
                </div>
                <div class="col-6">
                    <div class="bor10 p-lr-40 p-t-30 p-b-40">
                        <h4 class="mtext-109 cl2 p-b-30">
                            Thông tin đơn hàng
                        </h4>
                        <div class="flex-w flex-t bor12 p-b-13">
                            <div class="size-208">
									<span class="stext-110 cl2">
										Tổng tiền:
									</span>
                            </div>

                            <div class="size-209">
									<span class="mtext-110 cl2" id="sub-total">

									</span>
                            </div>
                        </div>
                        <div class="flex-w flex-t bor12 p-t-15 p-b-30">
                            <div class="size-208 w-full-ssm">
									<span class="stext-110 cl2">
										Giảm giá voucher:
									</span>

                            </div>
                            <div class="size-209">
									<span class="mtext-110 cl2" id="voucher-pic">
                                        0 VND
									</span>
                            </div>
                        </div>
                        <div class="flex-w flex-t bor12 p-t-15 p-b-30">
                            <div class="size-208 w-full-ssm">
									<span class="stext-110 cl2">
										Phí vận chuyển:
									</span>

                            </div>
                            <div class="size-209">
									<span class="mtext-110 cl2" id="shipping-fee">
                                        0 VND
									</span>
                            </div>
                        </div>
                        <div class="flex-w flex-t p-t-27 p-b-33">
                            <div class="size-208">
									<span class="mtext-101 cl2">
										Thành tiền:
									</span>
                            </div>

                            <div class="size-209 p-t-1">
									<span class="mtext-110 cl2" id="all-total">

									</span>
                            </div>
                        </div>
                        <div class="flex-w flex-t p-t-27 p-b-33">
                            <div class="size-208">
									<span class="mtext-101 cl2">
										Phương thức thanh toán:
									</span>
                            </div>

                            <div class="size-209 p-t-1">
                                <div class="form-group">
                                    <input type="radio" class="custom-radio" value="3" name="paymentMethod"
                                           id="payment-online" checked>
                                    <label for="payment-online">Thanh toán qua thẻ ngân hàng (Card Payment)</label>
                                </div>
                                <div class="form-group">
                                    <input type="radio" class="custom-radio" value="1" name="paymentMethod"
                                           id="payment-offline">
                                    <label for="payment-offline">Thanh toán khi nhận hàng (COD)</label>
                                </div>
                            </div>
                        </div>
                        <!--                    <div class="mb-5">-->
                        <!--                        <span class="text-danger font-weight-bold" style="font-size: 20px">Lưu ý: Chỉ ship trong khu vực Nghệ AN, phí ship(30k) khách tự trả</span>-->
                        <!--                    </div>-->
                        <label class="checkbox d-flex">
                            <input type="checkbox" class="mr-2" id="term">
                            Tôi đồng ý với <a style="color: blue" data-toggle="modal" data-target="#exampleModalCenter2">&nbsp;
                            điều khoản &nbsp</a> của cửa hàng.
                        </label>
                        <button type="button" id="submitBtn"
                                class="flex-c-m stext-101 cl0 size-116 bg3 bor14 hov-btn3 p-lr-15 trans-04 pointer"
                                disabled>
                            Đặt hàng
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </form>
    <div class="modal fade" style="z-index: 3000" id="exampleModalCenter2" tabindex="-1" role="dialog"
         aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
            <div class="modal-content" style="max-width24: 100%">
                <div class="modal-header">
                    <h5 class="modal-title" style="font-weight: bold">Điều khoản</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p>1. Người mua đã thanh toán bằng cách phương thức thanh toán hợp lệ nhưng không nhận được sản
                        phẩm, sản phẩm bị lỗi hoặc bị hư hại, sai sản phẩm, không ưng ý.</p>
                    <p>2. Có thể gửi yêu cầu trả hàng/hoàn tiền trong vòng 7 ngày kể từ lúc đơn hàng được cập nhật giao
                        hàng thành công.</p>
                    <p>3. Tất cả các yêu cầu trả hànghoàn tiền phải được thực hiện trên web hoặc liên hệ trực tiếp tới
                        cửa hàng</p>
                    <p>4. Phí gửi hàng lại do người mua trả</p>
                    <p>5. Mỗi hóa đơn chỉ được đổi trả 1 lần</p>
                    <p>6. Chỉ hỗ trợ đổi size, đổi màu, đổi sản phẩm bằng hoặc hơn giá</p>
                    <p>7. Người mua đóng gói và gửi trả sản phẩm bao gồm toàn bộ phụ kiện đi kèm, hóa đơn, tem phiếu bảo
                        hành (nếu có) và sản phẩm phải trong tình trạng nguyên vẹn như khi nhận hàng.</p>
                    <p>8. Người mua bắt buộc phải quay video hoặc chụp lại ảnh sản phẩm ngay khi nhận được và trong lúc
                        đóng gói hàng trả về để làm bằng chứng đối chiếu/khiếu nại về sau.</p>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Đóng</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Back to top -->
    <div class="btn-back-to-top" id="myBtn">
		<span class="symbol-btn-back-to-top">
			<i class="zmdi zmdi-chevron-up"></i>
		</span>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" th:inline="javascript"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <script th:inline="javascript">
        document.addEventListener('DOMContentLoaded', function () {
            document.getElementById('edit-name').addEventListener('click', function () {
                enableEdit('name');
            });
            document.getElementById('edit-phone').addEventListener('click', function () {
                enableEdit('phone');
            });
            document.getElementById('save-name').addEventListener('click', function () {
                saveEdit('name');
            });
            document.getElementById('save-phone').addEventListener('click', function () {
                saveEdit('phone');
            });
        });

        function enableEdit(field) {
            const display = document.getElementById(`${field}-display`);
            const input = document.getElementById(`${field}-input`);
            const editIcon = document.getElementById(`edit-${field}`);
            const saveIcon = document.getElementById(`save-${field}`);

            input.value = display.textContent.trim() || '';

            display.style.display = 'none';
            input.style.display = 'inline-block';
            editIcon.style.display = 'none';
            saveIcon.style.display = 'inline-block';
        }

        function saveEdit(field) {
            const display = document.getElementById(`${field}-display`);
            const input = document.getElementById(`${field}-input`);
            const editIcon = document.getElementById(`edit-${field}`);
            const saveIcon = document.getElementById(`save-${field}`);

            const newValue = input.value.trim();
            if (!newValue) {
                Swal.fire({
                    icon: 'warning',
                    title: 'Lỗi !',
                    text: 'Thông tin không được bỏ trống !'
                })
                return;
            }

            display.textContent = newValue;
            input.style.display = 'none';
            display.style.display = 'inline-block';
            editIcon.style.display = 'inline-block';
            saveIcon.style.display = 'none';

            const data = {
                name: document.getElementById('name-display').textContent.trim(),
                phoneNumber: document.getElementById('phone-display').textContent.trim()
            };


            fetch('/shoping-cart/update-profile', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
                .then(response => {
                    if (response.ok) {
                        return response.text();
                    } else {
                        return response.text().then(errorMessage => {
                            throw new Error(errorMessage);
                        });
                    }
                })
                .then(result => {
                    Toastify({
                        text: result || 'Thông tin đã được sửa thành công!',
                        className: "info",
                        style: {
                            background: "linear-gradient(to right, #00b09b, #96c93d)"
                        }
                    }).showToast();
                })
                .catch(error => {
                    Swal.fire({
                        icon: 'error',
                        title: 'Lỗi!',
                        text: error.message,
                        confirmButtonText: 'Đồng ý'
                    });
                });
        }

        $(document).ready(function () {
            var voucherList = [[${discountCodes}]]
            var voucherChoosed;

            $('.how-itemcart1').on('click', function (event) {
                event.preventDefault();

                var button = $(this);
                var cartRow = button.parent().parent();
                var cartId = cartRow.find('.cartId').val();
                Swal.fire({
                    title: 'Xóa sản phẩm',
                    text: 'Bạn chắc chắc muốn xóa sản phẩm này khỏi giỏ hàng?',
                    icon: 'warning',
                    showCancelButton: true,
                    cancelButtonText: 'Hủy',
                    confirmButtonText: 'Xác nhận',
                    reverseButtons: true
                }).then((result) => {
                    if (result.isConfirmed) {
                        $.ajax({
                            type: 'POST',
                            url: `http://localhost:8080/api/deleteCart/${cartId}`,
                            success: function () {
                                console.log('Item deleted successfully');

                                Swal.fire({
                                    icon: 'success',
                                    title: 'Thành công',
                                    text: 'Sản phẩm đã được xóa khỏi giỏ hàng!'
                                }).then(() => {
                                    location.reload();
                                });
                            },
                            error: function (err) {
                                console.error('Error deleting item:', err);

                                Swal.fire({
                                    icon: 'error',
                                    title: 'Lỗi',
                                    text: 'Không thể xóa sản phẩm, vui lòng thử lại sau!'
                                });
                            }
                        });
                    }
                });
            });
            // địa chỉ đầu
            // var addressSelected = {
            //     street: '',
            //     ward: '',
            //     district: '',
            //     province: 'Nghệ An',
            //
            // }
            //
            // var province = []
            // var district = []
            // var ward = []
            //

            //
            // $("#save-address-btn").on('click', function () {
            //
            //     const district = $("#district").val()
            //     const ward = $("#ward").val();
            //     const street = $("#street").val().trim()
            //     if (district == "" || ward == "" || street == "") {
            //         Swal.fire({
            //             icon: 'error',
            //             title: 'Lỗi',
            //             text: 'Vui lòng nhập đầy đủ địa chỉ !'
            //         });
            //     } else {
            //         addressSelected.street = street
            //         var dataSend = {
            //             address: Object.entries(addressSelected)
            //                 .filter(([key, value]) => value !== null && value !== '')
            //                 .map(([key, value]) => value)
            //                 .join(', ')
            //         }
            //         $.ajax({
            //             type: 'POST',
            //             contentType: "application/json; charset=utf-8",
            //             url: `api/public/addressShipping`,
            //             data: JSON.stringify(dataSend),
            //             success: function (data) {
            //                 const content = `
            //                                <div class="shipping-choose">
            //                                    <div id="shipping${data.id}">
            //                                        <p>${data.address}</p>
            //                                    </div>
            //                                </div>
            //                            </div>`
            //
            //                 $('.address-list').append(content)
            //                 $(".shipping-choose").on('click', function () {
            //                     $(".shipping-choose").removeClass('active')
            //                     $(this).addClass('active')
            //                 })
            //             },
            //             error: function (xhr, status, error) {
            //                 $('#loading-overlay').hide();
            //                 swal("Lỗi", xhr.responseJSON.message, "error")
            //             }
            //         })
            //         $("#add-address").show()
            //         $("#address-select-group").hide()
            //     }
            // })
            //
            // $("#cancel-add-address").on('click', function () {
            //     $("#add-address").show()
            //     $("#address-select-group").hide()
            // })
            // $("#province").on('change', function () {
            //     var provinceId = $(this).val()
            //     if (provinceId == "") {
            //         $("#district").html('')
            //     } else {
            //         const selectedOption = province.find((option) => option.value === provinceId)
            //         addressSelected.province = selectedOption.label
            //         $.ajax({
            //             type: 'GET',
            //             dataType: "json",
            //             url: `https://api.vnappmob.com/api/v2/province/district/40`,
            //             success: function (data) {
            //                 district = data.results.map(item => ({value: item.district_id, label: item.district_name}))
            //                 loadDistrictSelect(data)
            //             }
            //         })
            //     }
            //
            // })
            //
            // $.ajax({
            //     type: 'GET',
            //     dataType: "json",
            //     url: `https://api.vnappmob.com/api/v2/province/district/40`,
            //     success: function (data) {
            //         district = data.results.map(item => ({value: item.district_id, label: item.district_name}))
            //         loadDistrictSelect(data)
            //     }
            // })
            //
            // $("#district").on('change', function () {
            //     var districtId = $(this).val()
            //
            //     if (districtId == "") {
            //         $("#ward").html('')
            //     } else {
            //         const selectedOption = district.find((option) => option.value === districtId)
            //         addressSelected.district = selectedOption.label
            //         $.ajax({
            //             type: 'GET',
            //             dataType: "json",
            //             url: `https://vapi.vnappmob.com/api/v2/province/ward/${districtId}`,
            //             success: function (data) {
            //                 ward = data.results.map(item => ({value: item.ward_id, label: item.ward_name}))
            //                 loadWardSelect(data)
            //             }
            //         })
            //     }
            //
            // })

            var addressSelected = {
                street: '',
                ward: '',
                district: '',
                province: ''
            };

            var province = [];
            var district = [];
            var ward = [];

// Khởi tạo Select2
            function initializeSelect2() {
                $('.js-select2').select2({
                    minimumResultsForSearch: Infinity
                });
            }
            $(".shipping-choose").on('click', function () {
                $(".shipping-choose").removeClass('active')
                $(this).addClass('active')
            })

// Hiển thị form thêm địa chỉ
            $("#add-address").on('click', function () {
                $("#address-select-group").show();
                $("#add-address").hide();
            });

// Hủy thêm địa chỉ
            $("#cancel-add-address").on('click', function () {
                $("#address-select-group").hide();
                $("#add-address").show();
            });
// load lại địa chỉ

// Lưu địa chỉ
            $("#save-address-btn").on('click', function () {
                const street = $("#street").val().trim();
                const provinceVal = $("#province").val();
                const districtVal = $("#district").val();
                const wardVal = $("#ward").val();

                if (!provinceVal || !districtVal || !wardVal || !street) {
                    Swal.fire({
                        icon: 'error',
                        title: 'Lỗi',
                        text: 'Vui lòng nhập đầy đủ địa chỉ!'
                    });
                    return;
                }

                addressSelected.street = street;

                const dataSend = {
                    address: Object.values(addressSelected).filter(Boolean).join(', ')
                };

                $.ajax({
                    type: 'POST',
                    contentType: "application/json; charset=utf-8",
                    url: `api/public/addressShipping`,
                    data: JSON.stringify(dataSend),
                    success: function (data) {
                        const content = `
                <div class="shipping-choose">
                    <div id="shipping${data.id}">
                        <p>${data.address}</p>
                    </div>
                </div>`;
                        $('.address-list').append(content);

                        $(".shipping-choose").on('click', function () {
                            $(".shipping-choose").removeClass('active');
                            $(this).addClass('active');
                        });

                        $("#address-select-group").hide();
                        $("#add-address").show();
                             location.reload();
                    },
                    error: function (xhr) {
                        Swal.fire("Lỗi", xhr.responseJSON?.message || "Không thể lưu địa chỉ", "error");
                    }
                });
            });


// Load danh sách tỉnh
            $.ajax({
                type: 'GET',
                dataType: "json",
                url: `https://provinces.open-api.vn/api/p/`,
                success: function (data) {
                    provinces = data.map(item => ({ value: item.code.toString(), label: item.name }));
                    loadProvinceSelect(provinces);
                }
            });

            function loadProvinceSelect(provinces) {
                var selectElement = document.getElementById("province");
                selectElement.innerHTML = '<option value="">Chọn tỉnh, thành phố</option>';
                provinces.forEach(item => {
                    var option = document.createElement("option");
                    option.value = item.value;
                    option.text = item.label;
                    selectElement.appendChild(option);
                });
                resetDistrictWard();
            }

            function resetDistrictWard() {
                $("#district").html('<option value="">Chọn quận, huyện</option>');
                $("#ward").html('<option value="">Chọn phường, xã</option>');
                districts = [];
                wards = [];
            }

// Khi chọn tỉnh -> load Quận/Huyện
            $("#province").on('change', function () {
                var provinceId = $(this).val();
                addressSelected.province = provinces.find(p => p.value === provinceId)?.label || '';
                if (provinceId === "") {
                    resetDistrictWard();
                    addressSelected.district = '';
                    addressSelected.ward = '';
                    return;
                }
                $.ajax({
                    type: 'GET',
                    dataType: "json",
                    url: `https://provinces.open-api.vn/api/p/${provinceId}?depth=2`, // Lấy tỉnh + districts
                    success: function (data) {
                        districts = data.districts.map(item => ({ value: item.code.toString(), label: item.name }));
                        loadDistrictSelect(districts);
                        addressSelected.district = '';
                        addressSelected.ward = '';
                    }
                })
            })

            function loadDistrictSelect(districts) {
                var selectElement = document.getElementById("district");
                selectElement.innerHTML = '<option value="">Chọn quận, huyện</option>';
                districts.forEach(item => {
                    var option = document.createElement("option");
                    option.value = item.value;
                    option.text = item.label;
                    selectElement.appendChild(option);
                });
                $("#ward").html('<option value="">Chọn phường, xã</option>');
            }

// Khi chọn quận/huyện -> load phường/xã
            $("#district").on('change', function () {
                var districtId = $(this).val();
                if (districtId === "") {
                    $("#ward").html('<option value="">Chọn phường, xã</option>');
                    addressSelected.district = '';
                    addressSelected.ward = '';
                    return;
                }
                const selectedDistrict = districts.find(d => d.value === districtId);
                addressSelected.district = selectedDistrict ? selectedDistrict.label : '';
                $.ajax({
                    type: 'GET',
                    dataType: "json",
                    url: `https://provinces.open-api.vn/api/d/${districtId}?depth=2`, // Lấy xã/phường
                    success: function (data) {
                        wards = data.wards.map(item => ({ value: item.code.toString(), label: item.name }));
                        loadWardSelect(wards);
                        addressSelected.ward = '';
                    }
                })
            })

            function loadWardSelect(wards) {
                var selectElement = document.getElementById("ward");
                selectElement.innerHTML = '<option value="">Chọn phường, xã</option>';
                wards.forEach(item => {
                    var option = document.createElement("option");
                    option.value = item.value;
                    option.text = item.label;
                    selectElement.appendChild(option);
                });
            }

// Khi chọn phường/xã
            $("#ward").on('change', function () {
                var wardId = $(this).val();
                const selectedWard = wards.find(w => w.value === wardId);
                addressSelected.ward = selectedWard ? selectedWard.label : '';
            })

// địa chỉ cuối
//
//             $("#ward").on('change', function () {
//                 const selectedOption = ward.find((option) => option.value === $(this).val());
//                 addressSelected.ward = selectedOption ? selectedOption.label : '';
//             });

            function updateSubtotal(row) {
                var quantity = parseInt(row.find(".num-product").val());
                var price = parseFloat(removeAnyNonDigit(row.find('.product-price').text()));
                var subtotal = quantity * price;
                row.find('.total-money').text(formatNumber(subtotal) + ' VND');
            }

            // function calculateVoucherPrice() {
            //     if (voucherChoosed) {
            //         if (voucherChoosed.percentage) {
            //             var voucherPriceLast;
            //             var totalMoney = removeAnyNonDigit($('#sub-total').text())
            //             var value = parseFloat(totalMoney) * voucherChoosed.percentage / 100
            //             if (value > voucherChoosed.maximumAmount) {
            //                 voucherPriceLast = voucherChoosed.maximumAmount
            //             } else {
            //                 voucherPriceLast = Math.round(value)
            //             }
            //             $("#voucher-pic").text(formatNumber(voucherPriceLast))
            //         } else {
            //             if (voucherChoosed.discountAmount) {
            //                 $("#voucher-pic").text(formatNumber(voucherChoosed.discountAmount))
            //
            //             }
            //         }
            //     } else {
            //         $("#voucher-pic").text('0')
            //
            //     }
            // }
            function calculateVoucherPrice() {
                // Kiểm tra xem voucher đã được chọn hay chưa
                if (voucherChoosed) {
                    let voucherPriceLast;

                    // Lấy giá trị tổng tiền từ phần tử #sub-total
                    var totalMoney = removeAnyNonDigit($('#sub-total').text());

                    // Kiểm tra loại voucher
                    if (voucherChoosed.percentage) {
                        // Tính giá trị giảm giá theo phần trăm
                        var value = parseFloat(totalMoney) * voucherChoosed.percentage / 100;
                        // Kiểm tra xem giá trị giảm giá có vượt quá mức tối đa không
                        if (value > voucherChoosed.maximumAmount) {
                            voucherPriceLast = voucherChoosed.maximumAmount;
                        } else {
                            voucherPriceLast = Math.round(value);
                        }
                    } else if (voucherChoosed.discountAmount) {
                        // Nếu voucher là một khoản giảm giá cố định
                        voucherPriceLast = voucherChoosed.discountAmount;
                    }

                    // Cập nhật hiển thị cho giá trị giảm giá
                    $("#voucher-pic").text(formatNumber(voucherPriceLast));
                } else {
                    // Nếu không có voucher nào được chọn
                    $("#voucher-pic").text('0');
                }
            }
            function calculateTotal() {
                var total = 0;

                $('.table-row').each(function () {
                    var subtotal = parseFloat($(this).find('.total-money').text().replace(/[^0-9]/g, '')) || 0;
                    total += subtotal;
                });

                var shippingFee = parseFloat($('#shipping-fee').text().replace(/[^0-9]/g, '')) || 0;

                total += shippingFee;

                $('#sub-total').text(formatNumber(total) + ' VND');

                var voucherDiscount = parseFloat($('#voucher-pic').text().replace(/[^0-9]/g, '')) || 0;

                var finalTotal = total - voucherDiscount;

                finalTotal = finalTotal < 0 ? 0 : finalTotal;

                $('#all-total').text(formatNumber(finalTotal) + ' VND');
            }

            const shippingFee = 30000; // 30k
            const shippingFeeElement = document.getElementById("shipping-fee");

            document.querySelectorAll(".address-item").forEach((item) => {
                item.addEventListener("click", () => {
                    shippingFeeElement.textContent = `${shippingFee.toLocaleString('vi-VN')} VND`;

                    calculateTotal();
                });
            });

            document.querySelectorAll(".voucher-item").forEach((voucher) => {
                voucher.addEventListener("click", () => {
                    // Cập nhật giá trị voucher
                    const voucherDiscount = parseFloat(voucher.getAttribute("data-discount")) || 0;
                    document.getElementById("voucher-pic").textContent = `${voucherDiscount.toLocaleString()} VND`;

                    // Gọi lại hàm tính tổng để đảm bảo phí vận chuyển được cộng
                    calculateTotal();
                });
            });

            // Calculate the initial total and update subtotals
            $('.table-row').each(function () {
                updateSubtotal($(this));
            });
            calculateTotal();

            // When quantity is changed, update subtotal and recalculate total
            $(".num-product").on('change', function () {
                if ($(this).val() > 500) {
                }

                $('#selected-voucher').html('')
                $('#selected-voucher').attr('data-selected', "")
                voucherChoosed = null
                calculateVoucherPrice()


                var row = $(this).closest('.table-row');
                updateSubtotal(row);
                calculateTotal();
                updateToServer(row, $(this).val())

                $('#selected-voucher').html('')
                $('#selected-voucher').attr('data-selected', "")
            });

            $('.num-product').on('keypress', function (e) {
                onlyAllowNumberInput(e)
            })

            $('.num-product').on('focusout', function (e) {
                if ($(this).val() == '') {
                    $(this).val(1)
                    $(this).trigger('change')
                }
            })

            function onlyAllowNumberInput(e) {
                const key = e.key;
                if (key === '-' || key == 0) {
                    e.preventDefault();
                }
            }


            $('.btn-num-product-down').on('click', function () {
                var numProduct = Number($(this).next().val());
// $(this).next().val(numProduct - 1)
                var row = $(this).closest('.table-row');
                $('#selected-voucher').html('')
                $('#selected-voucher').attr('data-selected', "")
                voucherChoosed = null
                calculateVoucherPrice();


                updateSubtotal(row);
                calculateTotal();
                updateToServer(row, row.find(".num-product").val())
            });

            $('.btn-num-product-up').on('click', function () {
                // var numProduct = Number($(this).prev().val());
                // $(this).prev().val(numProduct + 1);

                var row = $(this).closest('.table-row');
                if (row.find(".num-product").val() > 500) {
                    Swal.fire({
                        text: 'Bạn chỉ mua được tối đa 500 sản phẩm',
                        title: "Thông báo",
                        icon: 'warning',
                        confirmButtonText: "Đồng ý"
                    })
                    row.find(".num-product").val(500)
                    return
                }


                $('#selected-voucher').html('')
                $('#selected-voucher').attr('data-selected', "")
                voucherChoosed = null
                calculateVoucherPrice()

                updateSubtotal(row);
                calculateTotal();
                updateToServer(row, row.find(".num-product").val())
            });

            // $(document).ready(function() {
            //     $('.btn-num-product-up').on('click', function () {
            //         var row = $(this).closest('.table-row.product-item');
            //         var quantityInput = row.find('.num-product');
            //         var currentQuantity = Number(quantityInput.val());
            //         var productId = row.data('.cartId'); // lấy productId từ data attribute
            //
            //         if (!productId) {
            //             console.error('Không tìm thấy productId');
            //             return;
            //         }
            //
            //         // Gọi API lấy số lượng tồn kho
            //         $.ajax({
            //             url: '/api/product/' + productId + '/stock',
            //             method: 'GET',
            //             success: function(stockQuantity) {
            //                 if (isNaN(stockQuantity)) {
            //                     Swal.fire('Lỗi', 'Số lượng tồn kho không hợp lệ', 'error');
            //                     return;
            //                 }
            //
            //                 if (currentQuantity >= stockQuantity) {
            //                     Swal.fire({
            //                         title: 'Thông báo',
            //                         text: 'Bạn chỉ có thể mua tối đa ' + stockQuantity + ' sản phẩm',
            //                         icon: 'warning',
            //                         confirmButtonText: 'Đồng ý'
            //                     });
            //                     return;
            //                 }
            //
            //                 // Cho phép tăng số lượng
            //                 quantityInput.val(currentQuantity + 1);
            //
            //                 // Gọi các hàm cập nhật subtotal, tổng tiền, gửi cập nhật server
            //                 updateSubtotal(row);
            //                 calculateTotal();
            //                 updateToServer(row, quantityInput.val());
            //             },
            //             error: function() {
            //                 Swal.fire('Lỗi', 'Không thể lấy số lượng tồn kho', 'error');
            //             }
            //         });
            //     });
            // });
            // // voucher từ đây // Hồ Văn Trình
            // function loadVouchers() {
            //     var voucherModalBody = $('.modal-body'); // Chọn phần thân modal
            //     voucherModalBody.empty(); // Xóa nội dung cũ
            //
            //     // Duyệt qua danh sách voucher để tạo các phần tử HTML
            //     voucherList.forEach(function (voucher) {
            //         var amountDis = voucher.type === 2
            //             ? `${formatNumber(voucher.discountAmount)} VND`
            //             : `${voucher.percentage} %`;
            //
            //         var html = `
            // <div data-voucher-id="${voucher.id}" class="d-flex border border-primary rounded align-items-center cursor-pointer voucher-item mb-2">
            //     <div class="col-sm-3 d-flex justify-content-center align-items-center" style="background-color: rgb(219 234 254); height: 80px">
            //         <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
            //             <path fill="currentColor" d="M12.79 21L3 11.21v2c0 .53.21 1.04.59 1.41l7.79 7.79c.78.78 2.05.78 2.83 0l6.21-6.21c.78-.78.78-2.05 0-2.83L12.79 21z"></path>
            //             <path fill="currentColor" d="M11.38 17.41c.78.78 2.05.78 2.83 0l6.21-6.21c.78-.78.78-2.05 0-2.83L12.63.58A2.04 2.04 0 0 0 11.21 0H5C3.9 0 3 .9 3 2v6.21c0 .53.21 1.04.59 1.41l7.79 7.79zM7.25 3a1.25 1.25 0 1 1 0 2.5a1.25 1.25 0 0 1 0-2.5z"></path>
            //         </svg>
            //     </div>
            //     <div class="col-sm-9">
            //         <div class="w-full">
            //             <p class="font-weight-bold amount-dis">Giảm <span>${amountDis}</span></p>
            //             <div>
            //                 <span class="mr-4 amount-mini">${'Cho đơn từ ' + formatNumber(voucher.minimumAmountInCart) + ' VND'}</span>
            //                 <span class="amount-max">${voucher.type === 1 ? 'Giảm tối đa ' + formatNumber(voucher.maximumAmount) + ' VND' : ''}</span>
            //             </div>
            //         </div>
            //     </div>
            // </div>`;
            //
            //         voucherModalBody.append(html); // Thêm voucher vào modal
            //     });
            // }
            // $(".voucher-item").on('click', function () {
            //     var voucherId = $(this).attr('data-voucher-id')
            //     voucherChoosed = voucherList.find(item => item.id == voucherId)
            //     var amountDis = $(this).find('.amount-dis').text()
            //     var amountMin = $(this).find('.amount-mini').text()
            //     var amountMax = $(this).find('.amount-max').text()
            //
            //     if (parseFloat(voucherChoosed.minimumAmountInCart) > parseFloat(removeAnyNonDigit($('#sub-total').text()))) {
            //         Swal.fire({
            //             title: "Voucher",
            //             text: "Giá trị đơn hàng không đủ để áp dụng voucher này",
            //             icon: "error"
            //         });
            //         return;
            //     }
            //     var html = `<div class="d-flex align-items-center border border-primary rounded" style="width: 300px">
            //                     <div class="col-sm-3 d-flex justify-content-center align-items-center mr-2" style="background-color: rgb(219 234 254); height: 80px">
            //                         <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M12.79 21L3 11.21v2c0 .53.21 1.04.59 1.41l7.79 7.79c.78.78 2.05.78 2.83 0l6.21-6.21c.78-.78.78-2.05 0-2.83L12.79 21z"></path><path fill="currentColor" d="M11.38 17.41c.78.78 2.05.78 2.83 0l6.21-6.21c.78-.78.78-2.05 0-2.83L12.63.58A2.04 2.04 0 0 0 11.21 0H5C3.9 0 3 .9 3 2v6.21c0 .53.21 1.04.59 1.41l7.79 7.79zM7.25 3a1.25 1.25 0 1 1 0 2.5a1.25 1.25 0 0 1 0-2.5z"></path></svg>
            //                     </div>
            //                     <div>
            //                         <h5 class="font-weight-bold">${amountDis}</h5>
            //                         <p>${amountMin}</p>
            //                         <span>${amountMax}</span>
            //                     </div>
            //                     <span id="remove-voucher" class="cursor-pointer ml-5">&times;</span>
            //                 </div>`
            //
            //     $('#selected-voucher').html(html)
            //     $('#selected-voucher').attr('data-selected', voucherId)
            //     $("#remove-voucher").on('click', function () {
            //         $('#selected-voucher').attr('data-selected', "")
            //         $('#selected-voucher').html('')
            //         voucherChoosed = null
            //         calculateVoucherPrice()
            //         calculateTotal()
            //     })
            //
            //     $('#exampleModalCenter').modal('hide')
            //
            //
            //     calculateVoucherPrice()
            //     calculateTotal()
            // })
            //
            // $(document).ready(function () {
            //     // Gọi API để lấy danh sách voucher
            //     $.ajax({
            //         type: 'GET',
            //         url: '/api/private/discount-code-valid', // Địa chỉ API để lấy voucher
            //         success: function (response) {
            //             console.log(response); // Kiểm tra dữ liệu nhận được
            //             if (response && response.content) {
            //                 voucherList = response.content; // Lấy danh sách mã giảm giá từ thuộc tính content
            //                 loadVouchers(); // Gọi hàm để hiển thị voucher
            //             } else {
            //                 console.error('Dữ liệu không hợp lệ:', response);
            //                 Swal.fire({
            //                     icon: 'error',
            //                     title: 'Lỗi',
            //                     text: 'Dữ liệu không hợp lệ!'
            //                 });
            //             }
            //         },
            //         error: function (xhr, status, error) {
            //             console.error('Error fetching vouchers:', error);
            //             Swal.fire({
            //                 icon: 'error',
            //                 title: 'Lỗi',
            //                 text: 'Không thể tải danh sách voucher, vui lòng thử lại sau!'
            //             });
            //         }
            //     });
            // });
            function loadVouchers() {
                var voucherModalBody = $('.modal-body'); // Chọn phần thân modal
                voucherModalBody.empty(); // Xóa nội dung cũ

                // Duyệt qua danh sách voucher để tạo các phần tử HTML
                voucherList.forEach(function (voucher) {
                    var amountDis = voucher.type === 2
                        ? `${formatNumber(voucher.discountAmount)} VND`
                        : `${voucher.percentage} %`;

                    var html = `
            <div data-voucher-id="${voucher.id}" class="d-flex border border-primary rounded align-items-center cursor-pointer voucher-item mb-2">
                <div class="col-sm-3 d-flex justify-content-center align-items-center" style="background-color: rgb(219 234 254); height: 80px">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                        <path fill="currentColor" d="M12.79 21L3 11.21v2c0 .53.21 1.04.59 1.41l7.79 7.79c.78.78 2.05.78 2.83 0l6.21-6.21c.78-.78.78-2.05 0-2.83L12.79 21z"></path>
                        <path fill="currentColor" d="M11.38 17.41c.78.78 2.05.78 2.83 0l6.21-6.21c.78-.78.78-2.05 0-2.83L12.63.58A2.04 2.04 0 0 0 11.21 0H5C3.9 0 3 .9 3 2v6.21c0 .53.21 1.04.59 1.41l7.79 7.79zM7.25 3a1.25 1.25 0 1 1 0 2.5a1.25 1.25 0 0 1 0-2.5z"></path>
                    </svg>
                </div>
                <div class="col-sm-9">
                    <div class="w-full">
                        <p class="font-weight-bold amount-dis">Giảm <span>${amountDis}</span></p>
                        <div>
                            <span class="mr-4 amount-mini">${'Cho đơn từ ' + formatNumber(voucher.minimumAmountInCart) + ' VND'}</span>
                            <span class="amount-max">${voucher.type === 1 ? 'Giảm tối đa ' + formatNumber(voucher.maximumAmount) + ' VND' : ''}</span>
                        </div>
                    </div>
                </div>
            </div>`;

                    voucherModalBody.append(html); // Thêm voucher vào modal
                });

                // Gán sự kiện click cho các phần tử voucher-item
                $(".voucher-item").on('click', function () {
                    var voucherId = $(this).data('voucher-id');
                    voucherChoosed = voucherList.find(item => item.id == voucherId);
                    var amountDis = $(this).find('.amount-dis').text();
                    var amountMin = $(this).find('.amount-mini').text();
                    var amountMax = $(this).find('.amount-max').text();

                    if (parseFloat(voucherChoosed.minimumAmountInCart) > parseFloat(removeAnyNonDigit($('#sub-total').text()))) {
                        Swal.fire({
                            title: "Voucher",
                            text: "Giá trị đơn hàng không đủ để áp dụng voucher này",
                            icon: "error"
                        });
                        return;
                    }

                    var html = `<div class="d-flex align-items-center border border-primary rounded" style="width: 300px">
                        <div class="col-sm-3 d-flex justify-content-center align-items-center mr-2" style="background-color: rgb(219 234 254); height: 80px">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M12.79 21L3 11.21v2c0 .53.21 1.04.59 1.41l7.79 7.79c.78.78 2.05.78 2.83 0l6.21-6.21c.78-.78.78-2.05 0-2.83L12.79 21z"></path><path fill="currentColor" d="M11.38 17.41c.78.78 2.05.78 2.83 0l6.21-6.21c.78-.78.78-2.05 0-2.83L12.63.58A2.04 2.04 0 0 0 11.21 0H5C3.9 0 3 .9 3 2v6.21c0 .53.21 1.04.59 1.41l7.79 7.79zM7.25 3a1.25 1.25 0 1 1 0 2.5a1.25 1.25 0 0 1 0-2.5z"></path></svg>
                        </div>
                        <div>
                            <h5 class="font-weight-bold">${amountDis}</h5>
                            <p>${amountMin}</p>
                            <span>${amountMax}</span>
                        </div>
                        <span id="remove-voucher" class="cursor-pointer ml-5">&times;</span>
                    </div>`;

                    $('#selected-voucher').html(html);
                    $('#selected-voucher').attr('data-selected', voucherId);

                    // Gán sự kiện xóa voucher
                    $("#remove-voucher").on('click', function () {
                        $('#selected-voucher').attr('data-selected', "");
                        $('#selected-voucher').html('<p>Chưa chọn mã giảm giá</p>');
                        voucherChoosed = null;
                        calculateVoucherPrice();
                        calculateTotal();
                    });

                    $('#exampleModalCenter').modal('hide');

                    calculateVoucherPrice();
                    calculateTotal();
                });
            }

            $(document).ready(function () {
                // Gọi API để lấy danh sách voucher
                $.ajax({
                    type: 'GET',
                    url: '/api/private/discount-code-valid', // Địa chỉ API để lấy voucher
                    success: function (response) {
                        console.log(response); // Kiểm tra dữ liệu nhận được
                        if (response && response.content) {
                            voucherList = response.content; // Lấy danh sách mã giảm giá từ thuộc tính content
                            loadVouchers(); // Gọi hàm để hiển thị voucher
                        } else {
                            console.error('Dữ liệu không hợp lệ:', response);
                            Swal.fire({
                                icon: 'error',
                                title: 'Lỗi',
                                text: 'Dữ liệu không hợp lệ!'
                            });
                        }
                    },
                    error: function (xhr, status, error) {
                        console.error('Error fetching vouchers:', error);
                        Swal.fire({
                            icon: 'error',
                            title: 'Lỗi',
                            text: 'Không thể tải danh sách voucher, vui lòng thử lại sau!'
                        });
                    }
                });
            });
            var checkbox = $('#term');
            var submitBtn = $('#submitBtn');

            checkbox.change(function () {
                submitBtn.prop('disabled', !checkbox.prop('checked'));
            });


            // =============================HANDLE SUBMIT==============================
            $("#submitBtn").on('click', async function () {
                var voucherId = $("#selected-voucher").attr('data-selected')
                var orderDetails = []
                var promotion = removeAnyNonDigit($('#voucher-pic').text())
                $(".product-item").each(function () {
                    orderDetails.push({
                        productDetailId: $(this).find(".detailId").val(),
                        quantity: $(this).find(".num-product").val()
                    })
                })

                if (orderDetails.length <= 0) {
                    Swal.fire({
                        title: "Lỗi",
                        icon: "error",
                        text: "Giỏ hàng trống"
                    });
                    return;
                }

                if ($('.shipping-choose.active p').text().trim() == "") {
                    Swal.fire({
                        icon: 'error',
                        title: 'Thông báo',
                        text: 'Vui lòng chọn địa chỉ trước khi đặt hàng',
                        confirmButtonText: 'Đồng ý'
                    });
                    return;
                }

                var paymentMethodId = $('input[name="paymentMethod"]:checked').val();

                const dataSend = {
                    paymentMethodId: $('input[name="paymentMethod"]:checked').val(),
                    billingAddress: $('.shipping-choose.active p').text().trim(),
                    promotionPrice: promotion,
                    voucherId: voucherId,
                    orderDetailDtos: orderDetails
                }

                if (paymentMethodId == 3) {
                    const amount = removeAnyNonDigit($('#all-total').text())
                    await $.ajax({
                        type: 'POST',
                        dataTye: 'json',
                        url: `/api/payment?amount=${amount}`,
                        success: function (data) {
                            sessionStorage.setItem("orderTemp", JSON.stringify(dataSend))
                            window.location.href = data.url
                        },
                        error: function () {
                            swal("Lỗi", "Xảy ra lỗi trong quá trình thanh toán", "error")
                        }
                    })
                } else {
                    $('#loading-overlay').show();
                    await $.ajax({
                        type: 'POST',
                        url: '/api/orderUser',
                        data: JSON.stringify(dataSend),
                        contentType: "application/json; charset=utf-8",
                        success: function (data) {
                            $('#loading-overlay').hide();
                            Swal.fire({
                                title: 'Đặt hàng',
                                text: 'Đặt hàng thành công',
                                icon: 'success',
                                showCancelButton: true,
                                confirmButtonText: 'Tiếp tục mua sắm',
                                cancelButtonText: 'Hủy'
                            }).then((result) => {
                                if (result.isConfirmed) {
                                    // Chuyển trang khi người dùng nhấn "OK"
                                    window.location.href = '/product';
                                } else {
                                    window.location.reload()
                                }
                            });
                        },
                        error: function (xhr, status, error) {
                            $('#loading-overlay').hide();
                            swal("Lỗi", xhr.responseJSON.message, "error")
                        }
                    })
                }
            })
        })

        function removeAnyNonDigit(value) {
            return value.replace(/\D/g, '');
        }

        function formatNumber(number) {
            return number.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
        }

        var debounceTimer;

        function updateToServer(row, quantity) {
            if (debounceTimer) {
                clearTimeout(debounceTimer);
            }
            var dataSend = {
                id: row.find(".cartId").val(),
                quantity: quantity
            }
            debounceTimer = setTimeout(async function () {

                await $.ajax({
                    type: 'POST',
                    url: '/api/updateCart',
                    data: JSON.stringify(dataSend),
                    contentType: "application/json; charset=utf-8",
                    success: function (data) {
                    },
                    error: function (xhr, status, error) {
                        Swal.fire({
                            title: "Thông báo",
                            text: xhr.responseJSON.message,
                            icon: "warning"
                        })
                        row.find(".js-update-cart-up").val(1)
                        updateToServer(row, 1)
                    }

                })
            }, 200);
        }

        function loadProvinceSelect(data) {
            province = data.results.map(item => ({value: item.province_id, label: item.province_name}))
            var selectElement = document.getElementById("province");
            selectElement.innerHTML = '';

            var defaultOption = document.createElement("option");
            defaultOption.text = "Choose province";
            defaultOption.value = ""
            selectElement.appendChild(defaultOption);

            for (var i = 0; i < data.results.length; i++) {
                var option = document.createElement("option");
                option.text = data.results[i].province_name;
                option.value = data.results[i].province_id;
                selectElement.appendChild(option);
            }
        }

        function loadDistrictSelect(data) {
            district = data.results.map(item => ({value: item.district_id, label: item.district_name}))

            var selectElement = document.getElementById("district");

            selectElement.innerHTML = '';

            var defaultOption = document.createElement("option");
            defaultOption.text = "Chọn quận, huyện";
            defaultOption.value = ""
            selectElement.appendChild(defaultOption);

            for (var i = 0; i < data.results.length; i++) {
                var option = document.createElement("option");
                option.text = data.results[i].district_name;
                option.value = data.results[i].district_id;
                selectElement.appendChild(option);
            }
        }

        function loadWardSelect(data) {
            var selectElement = document.getElementById("ward");

            selectElement.innerHTML = '';

            var defaultOption = document.createElement("option");
            defaultOption.text = "Chọn phường, xã";
            defaultOption.value = ""
            selectElement.appendChild(defaultOption);

            for (var i = 0; i < data.results.length; i++) {
                var option = document.createElement("option");
                option.text = data.results[i].ward_name;
                option.value = data.results[i].ward_id;
                selectElement.appendChild(option);
            }
        }
    </script>
</div>


</body>
</html>
